<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <button class="btn btn-outline-light me-2" (click)="goBack()">
      <i class="fas fa-arrow-left"></i> Volver
    </button>
    <span class="navbar-brand mb-0 h1">
      <i class="fas fa-inbox"></i> Solicitudes de inscripci칩n
    </span>
    <button class="btn btn-outline-light" (click)="logout()">
      <i class="fas fa-sign-out-alt"></i> Salir
    </button>
  </div>
</nav>

<div class="container-fluid mt-4">
  <div class="row">
    <div class="col-12">
      <h2 class="mb-4">
        <i class="fas fa-clipboard-list"></i> Gesti칩n de solicitudes de inscripci칩n
      </h2>

      <!-- Filtros -->
      <div class="row mb-3">
        <div class="col-md-4">
          <label class="form-label fw-bold">Filtrar por estado:</label>
          <select class="form-select" [(ngModel)]="filtroEstado" (change)="aplicarFiltro()">
            <option value="pendiente">Pendientes</option>
            <option value="aceptada">Aceptadas</option>
            <option value="rechazada">Rechazadas</option>
            <option value="">Todas</option>
          </select>
        </div>
        <div class="col-md-8 d-flex align-items-end">
          <div class="alert alert-info mb-0 flex-grow-1">
            <i class="fas fa-info-circle me-2"></i>
            Mostrando: <strong>{{ solicitudesFiltradas.length }}</strong> solicitud(es)
            {{ filtroEstado ? 'con estado "' + filtroEstado + '"' : 'en total' }}
          </div>
        </div>
      </div>

      <!-- Loading -->
      <div *ngIf="loading" class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Cargando...</span>
        </div>
        <p class="mt-3 text-muted">Cargando solicitudes...</p>
      </div>

      <!-- Sin solicitudes -->
      <div *ngIf="!loading && solicitudesFiltradas.length === 0" class="alert alert-warning">
        <i class="fas fa-inbox fa-2x mb-2"></i>
        <p class="mb-0">
          No hay solicitudes {{ filtroEstado ? 'con estado "' + filtroEstado + '"' : 'en este momento' }}.
        </p>
      </div>

      <!-- Tabla de solicitudes -->
      <div *ngIf="!loading && solicitudesFiltradas.length > 0" class="card shadow">
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-dark">
                <tr>
                  <th>Estudiante</th>
                  <th>Email</th>
                  <th>Curso solicitado</th>
                  <th>Fecha</th>
                  <th>Estado</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let solicitud of solicitudesFiltradas">
                  <td>
                    <i class="fas fa-user-graduate me-2 text-primary"></i>
                    <strong>{{ solicitud.estudianteNombre }}</strong>
                  </td>
                  <td>
                    <i class="fas fa-envelope me-1 text-muted"></i>
                    {{ solicitud.estudianteEmail }}
                  </td>
                  <td>
                    <i class="fas fa-book me-2 text-success"></i>
                    {{ solicitud.cursoNombre }}
                  </td>
                  <td>
                    <i class="fas fa-calendar me-1 text-muted"></i>
                    {{ formatDate(solicitud.fechaSolicitud) }}
                  </td>
                  <td>
                    <span class="badge" [ngClass]="getEstadoBadgeClass(solicitud.estado)">
                      {{ solicitud.estado | titlecase }}
                    </span>
                  </td>
                  <td>
                    <div class="btn-group" *ngIf="solicitud.estado === 'pendiente'">
                      <button
                        (click)="aceptarSolicitud(solicitud)"
                        class="btn btn-sm btn-success"
                        title="Aceptar e inscribir estudiante">
                        <i class="fas fa-check"></i> Aceptar
                      </button>
                      <button
                        (click)="rechazarSolicitud(solicitud)"
                        class="btn btn-sm btn-danger"
                        title="Rechazar solicitud">
                        <i class="fas fa-times"></i> Rechazar
                      </button>
                    </div>
                    <span *ngIf="solicitud.estado !== 'pendiente'" class="text-muted">
                      <i class="fas fa-check-circle"></i> Procesada
                    </span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal para rechazar -->
<div class="modal fade" [class.show]="showModalRechazo" [style.display]="showModalRechazo ? 'block' : 'none'" *ngIf="showModalRechazo">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title">
          <i class="fas fa-times-circle me-2"></i>
          Rechazar solicitud
        </h5>
        <button type="button" class="btn-close btn-close-white" (click)="closeModalRechazo()"></button>
      </div>
      <div class="modal-body">
        <div class="alert alert-light">
          <p class="mb-1">
            <strong>Estudiante:</strong> {{ solicitudSeleccionada?.estudianteNombre }}
          </p>
          <p class="mb-0">
            <strong>Curso:</strong> {{ solicitudSeleccionada?.cursoNombre }}
          </p>
        </div>

        <div class="mb-3">
          <label class="form-label fw-bold">Motivo del rechazo *</label>
          <textarea
            class="form-control"
            [(ngModel)]="motivoRechazo"
            rows="4"
            placeholder="Ej: El curso requiere conocimientos previos que el estudiante no posee"></textarea>
          <small class="text-muted">Este motivo ser치 visible para el estudiante</small>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeModalRechazo()">
          <i class="fas fa-undo me-1"></i> Cancelar
        </button>
        <button class="btn btn-danger" (click)="confirmarRechazo()">
          <i class="fas fa-ban me-1"></i> Rechazar solicitud
        </button>
      </div>
    </div>
  </div>
</div>
<div class="modal-backdrop fade" [class.show]="showModalRechazo" *ngIf="showModalRechazo"></div>
